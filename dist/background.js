(()=>{function e(e){for(var t=0,o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return Math.abs(t)}chrome.action.onClicked.addListener((function(e){chrome.tabs.create({url:"options.html"})})),chrome.runtime.onMessage.addListener((function(t,o,c){if("updateBlocklist"===t.type){switch(t.action){case"add":l=t.url,s=c,chrome.storage.local.get({blocklist:[]},(function(t){var o=t.blocklist;-1===o.indexOf(l)&&(o.push(l),chrome.storage.local.set({blocklist:o},(function(){!function(t){var o={id:e(t),priority:1,action:{type:"redirect",redirect:{url:"http://localhost:8000/softblock.html"}},condition:{urlFilter:t,resourceTypes:["main_frame"]}};chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[o.id]},(function(){chrome.declarativeNetRequest.updateDynamicRules({addRules:[o]},(function(){console.log("Rule added/updated for URL:",t)}))}))}(l),s({status:"Blocklist updated",blocklist:o})})))}));break;case"remove":!function(t,o){chrome.storage.local.get({blocklist:[]},(function(c){var l=c.blocklist,s=l.indexOf(t);s>-1&&(l.splice(s,1),chrome.storage.local.set({blocklist:l},(function(){!function(t){var o=e(t);chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[o]},(function(){console.log("Removing rule for URL:",t)}))}(t),o({status:"Blocklist updated",blocklist:l})})))}))}(t.url,c);break;case"fetch":!function(e){chrome.storage.local.get({blocklist:[]},(function(t){t.blocklist?e({status:"success",blocklist:t.blocklist}):e({status:"error",blocklist:[],message:"No blocklist found"})}))}(c)}return!0}var l,s}))})();
(()=>{function e(){chrome.storage.local.clear((function(){console.log("Local blocklist has been cleared upon reload/startup.")})),chrome.storage.sync.clear((function(){console.log("Local blocklist has been cleared upon reload/startup.")})),chrome.declarativeNetRequest.getDynamicRules((function(e){var t=e.map((function(e){return e.id}));chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:t},(function(){chrome.runtime.lastError?console.error("Failed to remove rules:",chrome.runtime.lastError):console.log("All dynamic rules have been cleared.")}))}))}function t(e){for(var t=0,o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return Math.abs(t)}chrome.action.onClicked.addListener((function(e){chrome.tabs.create({url:"options.html"})})),chrome.runtime.onInstalled.addListener(e),chrome.runtime.onStartup.addListener(e),chrome.runtime.onMessage.addListener((function(e,o,c){if("updateBlocklist"===e.type){switch(e.action){case"add":r=e.url,l=c,chrome.storage.local.get({blocklist:[]},(function(e){var o=e.blocklist;-1===o.indexOf(r)&&(o.push(r),chrome.storage.local.set({blocklist:o},(function(){!function(e){var o=new URL(e).hostname;o.startsWith("www.")&&(o=o.substring(4));var c="*://*.".concat(o,"/*"),r={id:t(o),priority:1,action:{type:"redirect",redirect:{url:"http://localhost:8000/softblock.html"}},condition:{urlFilter:c,resourceTypes:["main_frame"]}};chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[r.id]},(function(){chrome.declarativeNetRequest.updateDynamicRules({addRules:[r]},(function(){console.log("Rule added/updated for URL:",e)}))}))}(r),l({status:"Blocklist updated",blocklist:o})})))}));break;case"remove":!function(e,o){chrome.storage.local.get({blocklist:[]},(function(c){var r=c.blocklist,l=r.indexOf(e);l>-1&&(r.splice(l,1),chrome.storage.local.set({blocklist:r},(function(){!function(e){var o=new URL(e).hostname;o.startsWith("www.")&&(o=o.substring(4));var c=t(o);chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[c]},(function(){console.log("Removing rule for URL:",e)}))}(e),o({status:"Blocklist updated",blocklist:r})})))}))}(e.url,c);break;case"fetch":!function(e){chrome.storage.local.get({blocklist:[]},(function(t){t.blocklist?e({status:"success",blocklist:t.blocklist}):e({status:"error",blocklist:[],message:"No blocklist found"})}))}(c)}return!0}var r,l}))})();
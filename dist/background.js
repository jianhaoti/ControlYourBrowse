(()=>{function e(){chrome.storage.local.clear((function(){console.log("Local blocklist has been cleared upon reload/startup.")})),chrome.storage.sync.clear((function(){console.log("Local blocklist has been cleared upon reload/startup.")})),chrome.declarativeNetRequest.getDynamicRules((function(e){var t=e.map((function(e){return e.id}));chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:t},(function(){chrome.runtime.lastError?console.error("Failed to remove rules:",chrome.runtime.lastError):console.log("All dynamic rules have been cleared.")}))}))}function t(e){for(var t=0,o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return Math.abs(t)}chrome.action.onClicked.addListener((function(e){chrome.tabs.create({url:"options.html"})})),chrome.runtime.onInstalled.addListener(e),chrome.runtime.onMessage.addListener((function(o,c,l){if("updateBlocklist"===o.type){switch(o.action){case"add":r=o.url,s=l,chrome.storage.local.get({blocklist:[]},(function(e){var o=e.blocklist;-1===o.indexOf(r)&&(o.push(r),chrome.storage.local.set({blocklist:o},(function(){!function(e){var o=new URL(e).hostname;"www"===o.split(".")[0]&&(o=o.substring(4));var c=t(o),l={id:c,priority:1,action:{type:"redirect",redirect:{url:"http://localhost:8000/softblock.html"}},condition:{urlFilter:"*://*".concat(o,"/*"),resourceTypes:["main_frame"]}};"*://music.".concat(o,"/*"),chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[c],addRules:[l]})}(r),s({status:"Blocklist updated",blocklist:o})})))}));break;case"remove":!function(e,o){chrome.storage.local.get({blocklist:[]},(function(c){var l=c.blocklist,r=l.indexOf(e);r>-1&&(l.splice(r,1),chrome.storage.local.set({blocklist:l},(function(){!function(e){var o=new URL(e).hostname;"www"===o.split(".")[0]&&(o=o.substring(4));var c=t(o);chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[c]},(function(){console.log("Removing rule for URL:",e)}))}(e),o({status:"Blocklist updated",blocklist:l})})))}))}(o.url,l);break;case"clear":e();break;case"fetch":!function(e){chrome.storage.local.get({blocklist:[]},(function(t){t.blocklist?e({status:"success",blocklist:t.blocklist}):e({status:"error",blocklist:[],message:"No blocklist found"})}))}(l)}return!0}var r,s}))})();
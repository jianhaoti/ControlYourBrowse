(()=>{function e(){chrome.storage.local.clear((function(){console.log("Local blocklist has been cleared upon reload/startup.")})),chrome.storage.sync.clear((function(){console.log("Local blocklist has been cleared upon reload/startup.")})),chrome.declarativeNetRequest.getDynamicRules((function(e){var t=e.map((function(e){return e.id}));chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:t},(function(){chrome.runtime.lastError?console.error("Failed to remove rules:",chrome.runtime.lastError):console.log("All dynamic rules have been cleared.")}))}))}function t(e){for(var t=0,o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return Math.abs(t)}chrome.action.onClicked.addListener((function(e){chrome.tabs.create({url:"options.html"})})),chrome.runtime.onInstalled.addListener(e),chrome.runtime.onStartup.addListener(e),chrome.runtime.onMessage.addListener((function(e,o,r){if("updateBlocklist"===e.type){switch(e.action){case"add":c=e.url,l=r,chrome.storage.local.get({blocklist:[]},(function(e){var o=e.blocklist;-1===o.indexOf(c)&&(o.push(c),chrome.storage.local.set({blocklist:o},(function(){!function(e){var o=new URL(e).hostname;o.startsWith("www.")&&(o=o.substring(4));var r="*://*.".concat(o,"/*"),c={id:t(o),priority:1,action:{type:"redirect",redirect:{url:"http://localhost:8000/softblock.html"}},condition:{urlFilter:r,resourceTypes:["main_frame"]}};console.log("Adding rule:",{pattern:r,baseDomain:o,url:e}),chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[c.id]},(function(){chrome.declarativeNetRequest.updateDynamicRules({addRules:[c]},(function(){console.log("Rule added/updated for URL:",e)}))}))}(c),l({status:"Blocklist updated",blocklist:o})})))}));break;case"remove":!function(e,o){chrome.storage.local.get({blocklist:[]},(function(r){var c=r.blocklist,l=c.indexOf(e);l>-1&&(c.splice(l,1),chrome.storage.local.set({blocklist:c},(function(){!function(e){var o=new URL(e).hostname;o.startsWith("www.")&&(o=o.substring(4));var r=t(o);chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[r]},(function(){console.log("Removing rule for URL:",e)}))}(e),o({status:"Blocklist updated",blocklist:c})})))}))}(e.url,r);break;case"fetch":!function(e){chrome.storage.local.get({blocklist:[]},(function(t){t.blocklist?e({status:"success",blocklist:t.blocklist}):e({status:"error",blocklist:[],message:"No blocklist found"})}))}(r)}return!0}var c,l}))})();
(()=>{function e(){chrome.storage.local.clear((function(){console.log("Local blocklist has been cleared upon reload/startup.")})),chrome.storage.sync.clear((function(){console.log("Local blocklist has been cleared upon reload/startup.")})),chrome.declarativeNetRequest.getDynamicRules((function(e){var t=e.map((function(e){return e.id}));chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:t},(function(){chrome.runtime.lastError?console.error("Failed to remove rules:",chrome.runtime.lastError):console.log("All dynamic rules have been cleared.")}))}))}function t(e){for(var t=0,o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return Math.abs(t)}chrome.action.onClicked.addListener((function(e){chrome.tabs.create({url:"options.html"})})),chrome.runtime.onInstalled.addListener(e),chrome.runtime.onStartup.addListener(e),chrome.runtime.onMessage.addListener((function(e,o,c){if("updateBlocklist"===e.type){switch(e.action){case"add":l=e.url,r=c,chrome.storage.local.get({blocklist:[]},(function(e){var o=e.blocklist;-1===o.indexOf(l)&&(o.push(l),chrome.storage.local.set({blocklist:o},(function(){!function(e){var o={id:t(new URL(e).hostname),priority:1,action:{type:"redirect",redirect:{url:"http://localhost:8000/softblock.html"}},condition:{urlFilter:"*://*.".concat(new URL(e).hostname,"/*"),resourceTypes:["main_frame"]}};chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[o.id]},(function(){chrome.declarativeNetRequest.updateDynamicRules({addRules:[o]},(function(){console.log("Rule added/updated for URL:",e)}))}))}(l),r({status:"Blocklist updated",blocklist:o})})))}));break;case"remove":!function(e,o){chrome.storage.local.get({blocklist:[]},(function(c){var l=c.blocklist,r=l.indexOf(e);r>-1&&(l.splice(r,1),chrome.storage.local.set({blocklist:l},(function(){!function(e){var o=t(new URL(e).hostname);chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[o]},(function(){console.log("Removing rule for URL:",e)}))}(e),o({status:"Blocklist updated",blocklist:l})})))}))}(e.url,c);break;case"fetch":!function(e){chrome.storage.local.get({blocklist:[]},(function(t){t.blocklist?e({status:"success",blocklist:t.blocklist}):e({status:"error",blocklist:[],message:"No blocklist found"})}))}(c)}return!0}var l,r}))})();